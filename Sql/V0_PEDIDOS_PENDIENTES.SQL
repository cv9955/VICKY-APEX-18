  SELECT P.ID ID ,P.ARTICULO_ID ART,P.CLIENTE_ID CLIENTE,P.FECHA FECHA_PED,P.FECHA_ENTREGA FECHA_ENT,
  P.CANTIDAD PEDIDO,
  PROD_PKG.pedido_PENDIENTE(P.ID,2) AS ENTREGADO,
   PROD_PKG.STOCK(ARTICULO_ID,0)  COMBINADO,
   PROD_PKG.STOCK(ARTICULO_ID,1)  PLANCHAS,
   PROD_PKG.STOCK(ARTICULO_ID,3)  PRODUCCION, 
   PROD_PKG.STOCK(ARTICULO_ID,4)  SIN_CONTAR,
   PROD_PKG.STOCK(ARTICULO_ID,2)  TERMINADO,
   OBS,
   SUM(P.CANTIDAD - PROD_PKG.pedido_PENDIENTE(P.ID,2)) 
      OVER (PARTITION BY P.ARTICULO_ID 
            ORDER BY NVL(P.FECHA_ENTREGA,P.FECHA+10) asc
            ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW ) PEDIDO_ACC
FROM VTA_PEDIDOS P
WHERE P.STATUS = 1
UNION ALL
  SELECT P.ID ID ,e.PART_ID ART,
P.CLIENTE_ID CLIENTE,P.FECHA FECHA_PED,P.FECHA_ENTREGA FECHA_ENT,
  p.CANTIDAD* e.cant PEDIDO,
  null ENTREGADO,
   PROD_PKG.STOCK(ARTICULO_ID,0)  COMBINADO,
   PROD_PKG.STOCK(ARTICULO_ID,1)  PLANCHAS,
   PROD_PKG.STOCK(ARTICULO_ID,3)  PRODUCCION, 
   PROD_PKG.STOCK(ARTICULO_ID,4)  SIN_CONTAR,
   PROD_PKG.STOCK(ARTICULO_ID,2)  TERMINADO,
      '>>' || ART_PKG.SCODIGO(P.ARTICULO_ID) OBS,
   SUM(P.CANTIDAD - PROD_PKG.pedido_PENDIENTE(P.ID,2))  
    OVER (PARTITION BY e.PART_ID 
            ORDER BY NVL(P.FECHA_ENTREGA,P.FECHA+10) asc 
            ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW ) PEDIDO_ACC
FROM VTA_PEDIDOS P,art_especial e
WHERE P.STATUS = 1
and e.art_id = p.ARTICULO_ID
/
