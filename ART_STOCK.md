# ARTSTOCK
> MANTIENE STOCK ARTICULOS ACTUALIZADO 

## TABLAS 
* TABLA ARTICULOS
  * ID
  * ALTA_PL  >> TOTAL PLANCHAS CORRUGADAS
  * BAJA_PL  >> TOTAL PLANCHAS A PRODUCCION
  * ALTA   	>> TOTAL CAJAS FABRICADAS
  * BAJA    >> TOTAL CAJAS REMITIDAS
  * STOCKED >> FECHA ULTIMA ACTUALIZACION

## PROCEDIMIENTOS

### X20_STOCK 
'''SQL
UPDATE ARTICULOS ART
    SET 
     ALTA_PL = (SELECT ALTA_PL FROM X20_ALTA_PL WHERE ARTICULO_ID = ART.ID),
     BAJA_PL = (SELECT BAJA_PL FROM X20_BAJA_PL WHERE ARTICULO_ID = ART.ID),
     ALTA = (SELECT ALTA FROM X20_ALTA WHERE ARTICULO_ID = ART.ID),
     BAJA = (SELECT BAJA FROM X20_BAJA WHERE ARTICULO_ID = ART.ID),
     STOCKED = SYSDATE
     WHERE STOCKED IS NULL
     ;
'''

## VISTA

### X20_ALTA_PL
'''SQL
SELECT ARTICULO_ID , SUM(CANT) ALTA_PL FROM (  
SELECT ART_1 ARTICULO_ID,CANT_1 CANT,ESTADO 
  FROM CABS_CORR_D     WHERE ART_1 IS NOT NULL AND ESTADO = 1     
  UNION ALL        
  SELECT ART_2 ARTICULO_ID,CANT_2 CANT,ESTADO 
  FROM CABS_CORR_D     WHERE ART_2 IS NOT NULL AND ESTADO = 1        
  UNION ALL        
  SELECT ART_3 ARTICULO_ID,CANT_3 CANT,ESTADO 
  FROM CABS_CORR_D     WHERE ART_3 IS NOT NULL AND ESTADO = 1        
  UNION ALL        
  SELECT ART ARTICULO_ID,CANT, ESTADO 
  FROM CABS_CORR_EXT
  WHERE ESTADO = 1
  ) 
GROUP BY ARTICULO_ID
'''

### X20_BAJA_PL
'''SQL
SELECT PLANCHA_ID ARTICULO_ID , SUM(CANT_PL) BAJA_PL FROM (
SELECT PLANCHA_ID,CANT_PL FROM PRODUCCION_PL
UNION ALL
SELECT PLANCHA_ID,CANT_PL FROM PRODUCCION
WHERE PLANCHA_ID IS NOT NULL)
GROUP BY PLANCHA_ID
'''

### X20_ALTA
'''SQL
SELECT  ARTICULO_ID , 
    SUM(NVL(CANTIDAD, CANT_PL * ART_MULT)) ALTA
FROM PRODUCCION
    GROUP BY ARTICULO_ID
'''	

### X20_BAJA
'''SQL 
SELECT ARTICULO_ID,
	SUM(CANTIDAD) BAJA
FROM vta_remitos_detalle
WHERE ARTICULO_ID IS NOT NULL
	GROUP BY ARTICULO_ID
''' 

## TRIGGERS

### TRIGGER ART_STOCK 
'''SQL 
CREATE OR REPLACE TRIGGER ART_STOCK 
AFTER UPDATE OF STOCKED ON ARTICULOS 
BEGIN
	X20_STOCK;
END;
'''

### TRIGGER ART_STOCK_1 
'''SQL
AFTER DELETE OR INSERT OR UPDATE 
	ON CABS_CORR_D 
FOR EACH ROW 
BEGIN
  UPDATE ARTICULOS ART
    SET 
    ALTA_PL = NULL,
    STOCKED = NULL
     WHERE ID IN (
        :NEW.ART_1,:OLD.ART_1,
        :NEW.ART_2,:OLD.ART_2,
        :NEW.ART_3,:OLD.ART_3);
END;
'''

### TRIGGER ART_STOCK_2
'''SQL 
AFTER DELETE OR INSERT OR UPDATE 
	ON CABS_CORR_EXT
FOR EACH ROW 
BEGIN
  UPDATE ARTICULOS ART
    SET 
    ALTA_PL = NULL,
    STOCKED = NULL
     WHERE ID IN (
        :NEW.ART,:OLD.ART);
END;
'''

### TRIGGER ART_STOCK_3 
'''SQL
FOR EACH ROW 
BEGIN
  UPDATE ARTICULOS ART
    SET  
     ALTA = NULL,
     BAJA_PL = NULL,
     STOCKED = NULL
     WHERE ID IN (
        :NEW.ID,:OLD.ID,
        :NEW.PLANCHA_ID,:OLD.PLANCHA_ID);
END;
'''

### TRIGGER ART_STOCK_4
'''SQL
AFTER INSERT OR UPDATE OR DELETE
    ON PRODUCCION_PL
FOR EACH ROW
BEGIN
    UPDATE ARTICULOS
     SET    BAJA_PL = NULL,
            STOCKED = NULL
     WHERE ID IN (:NEW.PLANCHA_ID, :OLD.PLANCHA_ID);
END ;
'''

### TRIGGER ART_STOCK_5
'''SQL
AFTER DELETE OR INSERT OR UPDATE 
	ON VTA_REMITOS_DETALLE 
FOR EACH ROW 
BEGIN
  UPDATE ARTICULOS ART
    SET 
	 BAJA = NULL ,
     STOCKED = NULL
     WHERE ID IN (
		:NEW.ARTICULO_ID,:OLD.ARTICULO_ID);
END;
'''