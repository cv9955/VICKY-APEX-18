# Z1_PEDIDOS
´´´SQL
 SELECT 
 P.ID PEDIDO_ID ,
 0 P11, 
 ARTICULO_ID, 
 ART.MULT, 
 ART.ART_TIPO_ID,
 ART.SCODIGO, 
 P.CANTIDAD,
 NVL(FECHA_ENTREGA,FECHA + 10) FECHA_ENTREGA, 
 (SELECT SUM(CANTIDAD) FROM V0_VTA_REMITOS_DETALLE WHERE VTA_PEDIDO_ID = P.ID AND ARTICULO_ID = P.ARTICULO_ID ) ENTREGADO,
 (SELECT SUM(CANTIDAD) FROM V0_VTA_REMITOS_DETALLE WHERE VTA_PEDIDO_ID = P.ID AND ARTICULO_ID = P.ARTICULO_ID AND STATUS IN (1)) REMITO_SIN_NUMERO,
 (SELECT SUM(CANTIDAD) FROM V0_VTA_REMITOS_DETALLE WHERE VTA_PEDIDO_ID = P.ID AND ARTICULO_ID = P.ARTICULO_ID AND STATUS IN (3,5)) SIN_DESPACHAR,
 (SELECT SUM(CANTIDAD) FROM V0_VTA_REMITOS_DETALLE WHERE VTA_PEDIDO_ID = P.ID AND ARTICULO_ID = P.ARTICULO_ID AND STATUS IN (8)   ) NO_ENTREGADO,    
 (SELECT SUM(CANTIDAD) FROM V0_VTA_REMITOS_DETALLE WHERE VTA_PEDIDO_ID = P.ID AND ARTICULO_ID = P.ARTICULO_ID AND STATUS IN (9,10)) ENTREGADO_OK
 FROM
    VTA_PEDIDOS P
    INNER JOIN V0_ARTICULOS ART 
	ON P.ARTICULO_ID = ART.ID
 WHERE P.STATUS = 1

UNION ALL

SELECT 
 P.ID PEDIDO_ID ,1 P11, ART.ID ARTICULO_ID, ART.MULT, ART.ART_TIPO_ID,ART.SCODIGO, 
  P.CANTIDAD * ART_11.CANT CANTIDAD ,
  NVL(FECHA_ENTREGA,FECHA + 10) FECHA_ENTREGA, 
 (SELECT SUM(R.CANTIDAD) FROM VTA_REMITOS_DETALLE R
    WHERE R.VTA_PEDIDO_ID = P.ID    AND R.ARTICULO_ID = ART.ID ) ENTREGADO,
  (SELECT SUM(CANTIDAD) FROM V0_VTA_REMITOS_DETALLE   
    WHERE VTA_PEDIDO_ID = P.ID    AND ARTICULO_ID = P.ARTICULO_ID 
    AND STATUS IN (1) ) REMITO_SIN_NUMERO,
  (SELECT SUM(CANTIDAD) FROM V0_VTA_REMITOS_DETALLE   
    WHERE VTA_PEDIDO_ID = P.ID    AND ARTICULO_ID = P.ARTICULO_ID 
    AND STATUS IN (3,5) ) SIN_DESPACHAR,
  (SELECT SUM(CANTIDAD) FROM V0_VTA_REMITOS_DETALLE   
    WHERE VTA_PEDIDO_ID = P.ID    AND ARTICULO_ID = P.ARTICULO_ID 
    AND STATUS IN (8) ) NO_ENTREGADO,    
  (SELECT SUM(CANTIDAD) FROM V0_VTA_REMITOS_DETALLE   
    WHERE VTA_PEDIDO_ID = P.ID    AND ARTICULO_ID = P.ARTICULO_ID 
    AND STATUS IN (9,10) ) ENTREGADO_OK
 FROM
    VTA_PEDIDOS P
    INNER JOIN ART_11 ON P.ARTICULO_ID = ART_11.ART_ID
    INNER JOIN V0_ARTICULOS ART ON ART_11.PART_ID = ART.ID
 WHERE P.STATUS = 1;
´´´


# Z2_PEDIDOS
´´´SQL
SELECT PEDIDO_ID ,P11, ARTICULO_ID ,MULT ,ART_TIPO_ID ,SCODIGO ,CANTIDAD ,ENTREGADO  ,  
 SUM (CANTIDAD - NVL(ENTREGADO,0)) 
	OVER (PARTITION BY ARTICULO_ID 
		ORDER BY FECHA_ENTREGA ASC 
		ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) PEDIDO_ACC,
 
    PROD_PKG.STOCK(ARTICULO_ID,3)  PRODUCCION, 
     PROD_PKG.STOCK(ARTICULO_ID,4) SIN_CONTAR,
    PROD_PKG.STOCK(ARTICULO_ID,2)  TERMINADO ,
    REMITO_SIN_NUMERO,SIN_DESPACHAR,NO_ENTREGADO,ENTREGADO_OK,
    
    CASE 
        WHEN SIN_DESPACHAR > 0 THEN 'Remito s/n'
        WHEN NO_ENTREGADO  > 0 THEN 'No Entregado'
        WHEN NVL(ENTREGADO,0) = 0 THEN 'Produccion'
        WHEN ENTREGADO_OK >= CANTIDAD *.9 THEN 'Recibido_Ok'
        WHEN ENTREGADO_OK > 0 THEN 'Entrega Parcial'
        WHEN ENTREGADO > 0 THEN 'Despachado'
    END pedido_style    
FROM Z1_PEDIDOS
´´´

# Z3_PEDIDOS
´´´SQL
 SELECT PEDIDO_ID ,P11,
ARTICULO_ID ,MULT ,ART_TIPO_ID ,SCODIGO ,
CANTIDAD ,ENTREGADO ,PEDIDO_ACC ,TERMINADO + SIN_CONTAR CAJAS_STOCK, PRODUCCION, PEDIDO_STYLE,
     LEAST(PEDIDO_ACC - TERMINADO - SIN_CONTAR  - PRODUCCION,CANTIDAD) CAJAS_A_FABRI
FROM Z2_PEDIDOS;
´´´

# Z4_PEDIDOS
´´´SQL
  SELECT PEDIDO_ID ,P11,ARTICULO_ID ,MULT ,
    ART_TIPO_ID ,SCODIGO , PEDIDO_STYLE,
    CANTIDAD ,ENTREGADO ,PEDIDO_ACC ,PRODUCCION ,CAJAS_STOCK ,    CAJAS_A_FABRI ,
    SUM ( CAJAS_A_FABRI / MULT) OVER (PARTITION BY ARTICULO_ID ORDER BY PEDIDO_ID ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) PLANCHAS_ACC,
     PROD_PKG.STOCK(ARTICULO_ID,0)  COMBINADO,
     PROD_PKG.STOCK(ARTICULO_ID,1)  PLANCHAS
FROM Z3_PEDIDOS 
UNION ALL
SELECT Z.PEDIDO_ID,2 P11,ART.ID ARTICULO_ID ,1 / ART_10.CANT ,
    ART.ART_TIPO_ID ,ART.SCODIGO ,Z.PEDIDO_STYLE,
    NULL CANTIDAD , NULL ENTREGADO , NULL PEDIDO_ACC , NULL PRODUCCION , NULL CAJAS_STOCK , Z.CAJAS_A_FABRI * ART_10.CANT  CAJAS_A_FABRI,
    SUM ( Z.CAJAS_A_FABRI * ART_10.CANT) OVER (PARTITION BY ART.ID ORDER BY PEDIDO_ID ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) PLANCHAS_ACC,
     PROD_PKG.STOCK(ART.ID,0)  COMBINADO,
     PROD_PKG.STOCK(ART.ID,1)  PLANCHAS
FROM Z3_PEDIDOS Z
INNER JOIN ART_10 ON Z.ARTICULO_ID = ART_10.ART_ID
INNER JOIN V0_ARTICULOS ART ON ART_10.PART_ID = ART.ID
where Z.CAJAS_A_FABRI > 0;
´´´

´´´SQL
  CREATE OR REPLACE FORCE EDITIONABLE VIEW "VIC"."Z4_PRODUCCION" ("VTA_PEDIDO_ID", "P11", "CLIENTE_ID", "OBS", "FECHA", "FECHA_ENTREGA", "PRECIO", "ARTICULO_ID", "MULT", "ART_TIPO_ID", "SCODIGO", "COLOR", "CANTIDAD", "ENTREGADO", "PEDIDO_STYLE", "PEDIDO_STYLE_2", "PEDIDO_ACC", "PRODUCCION", "TERMINADO", "CAJAS_A_FABRI", "PLANCHAS_ACC", "COMBINADO", "PLANCHAS", "PRODUCCION_ID", "SIN_CONTAR_ID", "TERMINADO_ID", "PREPARADO", "EN_VIAJE", "ENTREGADO_OK") AS 
  SELECT 
    P.ID VTA_PEDIDO_ID ,P11,
    P.CLIENTE_ID ,    P.OBS,    P.FECHA ,    P.FECHA_ENTREGA ,
    CASE P11 WHEN 1 THEN 0
    WHEN 2 THEN 0
    ELSE P.PRECIO END PRECIO,
    Z.ARTICULO_ID ,  A.MULT ,  A.ART_TIPO_ID ,A.SCODIGO ,A.COLOR,
    Z.CANTIDAD ,
    Z.ENTREGADO ,Z.PEDIDO_STYLE,
    
    CASE Z.PEDIDO_STYLE WHEN 'Produccion' THEN
(        CASE 
              WHEN Z.PLANCHAS_ACC > PLANCHAS + COMBINADO THEN 'A Fabri'
            WHEN Z.COMBINADO > 0 THEN 'Combinado'
            WHEN Z.PLANCHAS > 0  THEN 'Corrugado' 
            ELSE 'Produccion' end)
    
    ELSE Z.PEDIDO_STYLE END PEDIDO_STYLE_2 ,
    Z.PEDIDO_ACC ,
    Z.PRODUCCION ,
    Z.CAJAS_STOCK terminado ,
    Z.CAJAS_A_FABRI ,
    Z.PLANCHAS_ACC ,
    COMBINADO ,
    Z.PLANCHAS  ,
    (SELECT LISTAGG(ID, ':') WITHIN GROUP (ORDER BY ID) FROM PRODUCCION T WHERE ARTICULO_ID = Z.ARTICULO_ID AND T.STATUS = 1) PRODUCCION_ID,
    (SELECT LISTAGG(ID, ':') WITHIN GROUP (ORDER BY ID) FROM PRODUCCION T WHERE ARTICULO_ID = Z.ARTICULO_ID AND T.STATUS = 2) SIN_CONTAR_ID,
    (SELECT MAX(ID) FROM PRODUCCION T WHERE ARTICULO_ID = Z.ARTICULO_ID AND T.STATUS = 3) TERMINADO_ID,
 (SELECT SUM(CANTIDAD) FROM V0_VTA_REMITOS_DETALLE WHERE VTA_PEDIDO_ID = Z.PEDIDO_ID AND ARTICULO_ID = P.ARTICULO_ID AND STATUS IN (1,3,8)) PREPARADO ,
 (SELECT SUM(CANTIDAD) FROM V0_VTA_REMITOS_DETALLE WHERE VTA_PEDIDO_ID = Z.PEDIDO_ID AND ARTICULO_ID = P.ARTICULO_ID AND STATUS IN (5)) EN_VIAJE,
 (SELECT SUM(CANTIDAD) FROM V0_VTA_REMITOS_DETALLE WHERE VTA_PEDIDO_ID = Z.PEDIDO_ID AND ARTICULO_ID = P.ARTICULO_ID AND STATUS IN (9,10)) ENTREGADO_OK 
FROM z4_pedidos Z
    INNER JOIN VTA_PEDIDOS P ON z.pedido_id = P.ID
    INNER JOIN V0_ARTICULOS A ON Z.ARTICULO_ID = A.ID;
´´´



# Z5_PEDIDOS
´´´SQL
  SELECT
    PEDIDO_ID ,
    ARTICULO_ID ,
    CANTIDAD ,
    CAJAS_STOCK ,
    CAJAS_A_FABRI ,
    ENTREGADO,
    COMBINADO ,
    PLANCHAS , 
    PRODUCCION,
    LEAST(PLANCHAS_ACC - COMBINADO - PLANCHAS , TRUNC(CAJAS_A_FABRI / MULT))  PLANCHAS_A_FABRI
FROM Z4_PEDIDOS;
´´´

# Z6_FABRI
´´´SQL
SELECT Z.PEDIDO_ID VTA_PEDIDO_ID,PX.FECHA ,PX.FECHA_ENTREGA,PX.OBS,
Z.ARTICULO_ID,PX.CLIENTE_ID,
ART.SCODIGO,ART.PLARGO,ART.PANCHO,ART.LARGO,ART.ANCHO,ART.ALTO,ART.TRAZADOS,ART.ART_CALIDAD_ID,
Z.CANTIDAD CANTIDAD_PEDIDO,
Z.ENTREGADO,
Z.COMBINADO,
Z.PLANCHAS,
Z.PRODUCCION ,
Z.CAJAS_STOCK CAJAS,
Z.CAJAS_A_FABRI CAJAS_A_FABRI,
Z.PLANCHAS_A_FABRI PEDIDO_A_FABRI
FROM Z5_PEDIDOS Z
INNER JOIN v0_articulos ART ON Z.ARTICULO_ID = ART.ID 
INNER JOIN VTA_PEDIDOS PX ON z.pedido_ID = PX.ID 
WHERE Z.PLANCHAS_A_FABRI > 0
AND ART.ART_TIPO_ID NOT IN (10,11);
´´´


# PAG220 - FABRI
´´´SQL
SELECT 
    VTA_PEDIDO_ID,
    ARTICULO_ID ART,
    CLIENTE_ID CLIENTE,
    SCODIGO CODIGO,PLARGO,PANCHO,LARGO,ANCHO,ALTO,TRAZADOS,
    ART_CALIDAD_ID CALIDAD,
    ART_PKG.CALIDAD_STYLE(ART_CALIDAD_ID) AS calidad_style,
    cantidad_pedido PEDIDO,
    COMBINADO,
    PLANCHAS,
    PRODUCCION,
    CAJAS TERMINADO,
    PEDIDO_A_FABRI A_FABRI,
    PLARGO * PEDIDO_A_FABRI / 1000 AS METROS,
    PLARGO * PEDIDO_A_FABRI * PANCHO / 1000000 AS METROS2,
    (:P220_FORMATO*10 - :P220_R1 - PANCHO) AS DIF,
    FECHA FECHA_PED,
    FECHA_ENTREGA FEC_ENTREGA,
    OBS,
    CASE WHEN LENGTH(OBS)> 0 THEN 'fa fa-exclamation-triangle' 
       ELSE '' end as ICON_OBS,
    NVL(TO_CHAR(PALLET_PKG.MEDIDA_PALLET(ARTICULO_ID,'CANT_CAJAS')) ,
    '<i class="fa fa-cards fa-anim-spin" style="color : GREEN;"></i>') PALLET,
    ART_PKG.A_FABRI_2(ARTICULO_ID,cantidad_pedido,PEDIDO_A_FABRI) AS FABRI
FROM Z6_FABRI
WHERE  PEDIDO_A_FABRI >= 50  AND  ( NVL(FECHA_ENTREGA,SYSDATE) < SYSDATE + 20 OR :P220_FAV = 1)
´´´